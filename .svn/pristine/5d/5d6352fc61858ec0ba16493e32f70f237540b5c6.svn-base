package cn.smartcandy.application.cms.release;

import java.util.List;
import java.util.Map;

import cn.smartcandy.application.a.account.AccountBiz;
import cn.smartcandy.application.a.account.User;
import cn.smartcandy.application.a.collection.CollectionBiz;
import cn.smartcandy.common.common.BaseAction;
import cn.smartcandy.common.utils.TMemberUtils;
import cn.smartcandy.common.utils.TStringUtils;
import cn.smartcandy.framework.core.data.DataTable;
import cn.smartcandy.framework.utils.CStringUtils;

public class ReleaseAction extends BaseAction{
	private static final long serialVersionUID = -6834280112223031738L;
	private ReleaseBiz releaseBiz = new ReleaseBiz();

	// ----------------------------------------------------------轮播图发布
	// 添加轮播图 DONE
	public String addBannerMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
		releaseBiz.addBannerMsg(param,user);
		return null;
	}
	// 查询轮播图信息 DONE
	public String queryBannerMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
		ReleaseBanner queryBannerMsg = releaseBiz.queryBannerMsg(param);
		request.setAttribute("bannerMsg", queryBannerMsg);
		return null;
	}
	// 查询Banner列表 DONE
	public String queryBannerList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    DataTable dataTable = releaseBiz.queryBannerDataList(param,super.getPageNo(),super.getPageSize());
        List<Map<String, String>> bannerList = TStringUtils.turnDataTableToStringMapList(dataTable);
        request.setAttribute("bannerList", bannerList);
        
        Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// 更新Banner列表 DONE
	public String modifyBannerMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.modifyBannerMsg(param, super.getUser());
		return null;
	}
	// 删除Banner信息 DONE
	public String deleteBannerMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    param.put("relStatus", Release.STATUS_BLACK);
	    releaseBiz.modifyBannerMsg(param, super.getUser());
		return null;
	}
	
	// ----------------------------------------------------------新闻发布
	// 发布新闻
	public String addNewsMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	   	releaseBiz.addNewsMsg(param,user);
		return null;
	}
	// 查询新闻信息 DONE
	public String queryNewsMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    ReleaseNews queryNewsMsg = releaseBiz.queryNewsMsg(param);
		request.setAttribute("newsMsg", queryNewsMsg);
		return null;
	}
	// 查询新闻列表 DONE
	public String queryNewsList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    DataTable dataTable = releaseBiz.queryNewsDataList(param,super.getPageNo(),super.getPageSize());
        List<Map<String, String>> newsList = TStringUtils.turnDataTableToStringMapList(dataTable);
        request.setAttribute("newsList", newsList);
		
        Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// 更新News DONE
	public String modifyNewsMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.modifyNewsMsg(param, super.getUser());
		return null;
	}
	// 删除News信息 DONE
	public String deleteNewsMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    param.put("relStatus", Release.STATUS_BLACK);
	    releaseBiz.modifyNewsMsg(param, super.getUser());
		return null;
	}
	
	// ----------------------------------------------------------视频发布
	// 发布视频
	public String addVideoMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.addVideoMsg(param,user);
		return null;
	}
	// 查询Video信息 DONE
	public String queryVideoMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    ReleaseVideo videoMsg = releaseBiz.queryVideoMsg(param);
		request.setAttribute("videoMsg", videoMsg);
		return null;
	}
	// 查询video列表 DONE
	public String queryVideoList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    DataTable dataTable = releaseBiz.queryVideoList(param,super.getPageNo(),super.getPageSize());
        List<Map<String, String>> videoList = TStringUtils.turnDataTableToStringMapList(dataTable);
        request.setAttribute("videoList", videoList);
		
        Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// 更新Video DONE
	public String modifyVideoMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.modifyVideoMsg(param, super.getUser());
		return null;
	}
	// 删除Video信息 DONE
	public String deleteVideoMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    param.put("relStatus", Release.STATUS_BLACK);
	    releaseBiz.modifyVideoMsg(param, super.getUser());
		return null;
	}
	// ----------------------------------------------------------生活照发布
	// 发布生活照
	public String addPhotoMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    ReleasePhoto addPhotoMsg = releaseBiz.addPhotoMsg(param, super.getUser());
	    request.setAttribute("photoMsg", addPhotoMsg);
	    return null;
	}
	// 查询藏品生活照 DONE
	public String queryPhotoList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    
	    DataTable dataTable = releaseBiz.queryPhotoDataList(param,super.getPageNo(),super.getPageSize());
        List<Map<String, String>> photoList = TStringUtils.turnDataTableToStringMapList(dataTable);
        request.setAttribute("photoList", photoList);
		
        Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// ----------------------------------------------------------种类发布
	// 发布种类
	public String addCategaryMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.addCategaryMsg(param, super.getUser());
		return null;
	}
	// 查询种类信息 DONE
	public String queryCategaryMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    ReleaseCategary cateMsg = releaseBiz.queryCategaryMsg(param);
		request.setAttribute("cateMsg", cateMsg);
		return null;
	}
	// 查询种类列表  DONE 
	public String queryCategaryList(){
		List<ReleaseCategary> categaryList = TMemberUtils.getCategaryList(request);
	    request.setAttribute("categaryList", categaryList);
	    
	    Map<String, String> pageInfo = TStringUtils.turnListToPageInfoMap(categaryList);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// 查询种类列表  DONE 
	public String queryCategaryDataList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    DataTable dataTable = releaseBiz.queryCategaryDataList(param);
	    
	    List<Map<String, Object>> categaryListMap = TStringUtils.turnDataTableToObjectMapList(dataTable);
	    request.setAttribute("categaryList", categaryListMap);
	    
	    Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	// 更新Video DONE
	public String modifyCategaryMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    releaseBiz.modifyCategaryMsg(param, super.getUser());
		return null;
	}
	// 删除Video信息 DONE
	public String deleteCategaryMsg(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    param.put("cateStatus", Release.STATUS_BLACK);
	    releaseBiz.modifyCategaryMsg(param, super.getUser());
		return null;
	}

	
	// -----------------------------------用户中心----------------------------------- //
	// 查询种类列表，附带个人信息  DONE 
	public String queryReleasedCategaryList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    
		DataTable dataTable = new CollectionBiz().queryCategaryReleaseCount(param,user);
		List<Map<String, String>> categaryList = TStringUtils.turnDataTableToStringMapList(dataTable);
	    
	    List<ReleaseCategary> categaryList2 = TMemberUtils.getCategaryList(request);
	    for (int i = 0; i < categaryList2.size(); i++) {
	    	// 添加默认值
			String cateSequence = categaryList2.get(i).getCateSequence();
			categaryList2.get(i).setColCount(String.valueOf(0));
			// 设置真实值
			for (int j = 0; j < categaryList.size(); j++) {
				Map<String, String> map = categaryList.get(j);
				String value = map.get("cateSequence");
				if (CStringUtils.equals(cateSequence, value)) {
					categaryList2.get(i).setColCount(map.get("colCount"));
					break;
				}
			}
		}
	    request.setAttribute("categaryList", categaryList2);

	    //DONE 请求用户信息放进去
        User userMsg = new AccountBiz().queryUserAccount(param,request,user);
		request.setAttribute("userMsg", userMsg);
		
	    /*Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);*/
		return null;
	}
	
	// 查询用户点赞的藏品列表
	public String querylikeCategaryList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    
		DataTable dataTable = new CollectionBiz().querylikeCategaryList(param,user);
		List<Map<String, String>> categaryList = TStringUtils.turnDataTableToStringMapList(dataTable);
	    // 拿到种类数据
	    List<ReleaseCategary> categaryList2 = TMemberUtils.getCategaryList(request);
	    // 请求种类的点赞数量
	    for (int i = 0; i < categaryList2.size(); i++) {
	    	// 添加默认值
			String cateSequence = categaryList2.get(i).getCateSequence();
			categaryList2.get(i).setColCount(String.valueOf(0));
			// 设置真实值
			for (int j = 0; j < categaryList.size(); j++) {
				Map<String, String> map = categaryList.get(j);
				String value = map.get("cateSequence");
				if (CStringUtils.equals(cateSequence, value)) {
					categaryList2.get(i).setColCount(map.get("colCount"));
					break;
				}
			}
		}
	    request.setAttribute("categaryList", categaryList2);

	    //DONE 请求用户信息放进去
        User userMsg = new AccountBiz().queryUserAccount(param,request,user);
		request.setAttribute("userMsg", userMsg);
		
	    /*Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);*/
		return null;
	}
	// 查询用户发布的藏品 DONE
	public String queryReleasedDataList(){
        Map<String, String> param = TStringUtils.getStringMapFromRequest();
	    TStringUtils.printStringMap(param);
	    DataTable dataTable = releaseBiz.queryReleasedDataList(param, super.getPageNo(), super.getPageSize());
	    
	    // 查询藏品是否关注
		//List<Map<String, String>> collectionList = new CollectionBiz().selectColAttentionOrNot(dataTable, user);
	    // 不查询藏品是否关注
		List<Map<String, String>> collectionList = TStringUtils.turnDataTableToStringMapList(dataTable);
		
		// TODO 加上用户的
	    request.setAttribute("categaryList", collectionList);
	    Map<String, String> pageInfo = TStringUtils.turnDataTableToPageInfoMap(dataTable);
		request.setAttribute("pageInfo", pageInfo);
		return null;
	}
	
	
	

}
